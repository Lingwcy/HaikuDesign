---
title: Bubble
---

import { Avatar, Bubble, Button, PlayBoard } from "haiku-ui"
import * as React from "react"

export const VariantAndShapeDemo = () => {
  const variants = ["filled", "outlined", "shadow", "borderless"]
  const shapes = ["default", "round", "corner"]

  return (
    <div className="flex flex-col gap-4">
      {variants.map((variant) => (
        <div key={variant} className="flex flex-col gap-2">
          <div className="text-xs text-zinc-500">variant: {variant}</div>
          <div className="flex flex-col gap-2">
            {shapes.map((shape) => (
              <Bubble
                key={`${variant}-${shape}`}
                placement={shape === "corner" ? "end" : "start"}
                variant={variant}
                shape={shape}
                avatar={<Avatar icon="mdi:robot" size="sm" />}
                header={<span>Assistant</span>}
                content={`shape: ${shape}`}
              />
            ))}
          </div>
        </div>
      ))}
    </div>
  )
}

export const LoadingDemo = () => {
  const [loading, setLoading] = React.useState(true)
  return (
    <div className="flex flex-col gap-3">
      <div className="flex flex-wrap gap-2">
        <Button
          variant={loading ? "primary" : "default"}
          color="primary"
          onClick={() => setLoading((v) => !v)}
        >
          {loading ? "切换为完成" : "切换为加载"}
        </Button>
      </div>

      <Bubble
        avatar={<Avatar icon="mdi:robot" size="sm" />}
        header={<span>Assistant</span>}
        loading={loading}
        loadingRender={() => (
          <div className="flex items-center gap-2 text-zinc-500">
            <span className="size-4 animate-spin rounded-full border-2 border-current border-t-transparent" />
            <span>正在生成...</span>
          </div>
        )}
        content={"这段内容在 loading=true 时不会渲染。"}
        footer={<span className="text-zinc-500">loading={String(loading)}</span>}
      />
    </div>
  )
}

export const SlotAndContentRenderDemo = () => {
  const info = React.useMemo(
    () => ({
      key: "msg_1",
      status: "success",
      extraInfo: { model: "demo" },
    }),
    [],
  )

  return (
    <div className="flex flex-col gap-3">
      <Bubble
        info={info}
        avatar={() => <Avatar icon="mdi:robot" size="sm" />}
        header={(content, info) => (
          <div className="flex items-center gap-2">
            <span className="font-medium">Assistant</span>
            <span className="text-xs text-zinc-500">
              key={String(info.key)} / status={String(info.status)}
            </span>
          </div>
        )}
        extra={
          <Button size="sm" variant="text">
            ...
          </Button>
        }
        content={"我会把文本里的 Haiku 高亮出来。"}
        contentRender={(content) => {
          const text = String(content)
          const parts = text.split("Haiku")
          return (
            <span>
              {parts[0]}
              <span className="rounded bg-primary-100 px-1 text-primary-900">
                Haiku
              </span>
              {parts.slice(1).join("Haiku")}
            </span>
          )
        }}
        footer={(content, info) => (
          <span className="text-zinc-500">
            extraInfo.model={String(info.extraInfo && info.extraInfo.model)}
          </span>
        )}
      />
    </div>
  )
}

export const TypingEventsDemo = () => {
  const [content, setContent] = React.useState("")
  const [keepPrefix, setKeepPrefix] = React.useState(true)
  const [typingCount, setTypingCount] = React.useState(0)
  const [completeCount, setCompleteCount] = React.useState(0)

  const sharedPrefix =
    "共同前缀：这段文字在 A/B 中相同，用来观察 keepPrefix 的效果。"

  const load = (label) => {
    setTypingCount(0)
    setCompleteCount(0)
    setContent(
      `${sharedPrefix}\n当前选择：${label} - ${Math.random().toString(16).slice(2)}\n第二行用于测试换行。`,
    )
  }

  return (
    <div className="flex flex-col gap-3">
      <div className="flex flex-wrap items-center gap-2">
        <Button variant="primary" color="primary" onClick={() => load("A")}>
          加载 A
        </Button>
        <Button variant="primary" color="info" onClick={() => load("B")}>
          加载 B
        </Button>
        <Button variant="default" onClick={() => setContent("")}>
          清空
        </Button>
        <Button variant="text" onClick={() => setKeepPrefix((v) => !v)}>
          keepPrefix: {String(keepPrefix)}
        </Button>
        <span className="text-xs text-zinc-500">
          onTyping: {typingCount} / onTypingComplete: {completeCount}
        </span>
      </div>

      <Bubble
        avatar={<Avatar icon="mdi:robot" size="sm" />}
        header={<span>Assistant</span>}
        content={content}
        typing={{ effect: "fade-in", interval: 100, step: [1, 3], keepPrefix }}
        typingCursor="|"
        onTyping={() => setTypingCount((c) => c + 1)}
        onTypingComplete={() => setCompleteCount((c) => c + 1)}
      />
    </div>
  )
}

export const StreamTypingDemo = () => {
  const fullText =
    "Haiku Bubble：这是一段用于演示“流式 + 吐字”的文本。你会看到 content 在追加时，typing 会追赶并在末尾停住。"

  const [content, setContent] = React.useState("")
  const [streaming, setStreaming] = React.useState(false)
  const timerRef = React.useRef(null)

  const start = () => {
    if (timerRef.current != null) return
    setContent("")
    setStreaming(true)

    let i = 0
    timerRef.current = window.setInterval(() => {
      i += 3
      if (i < fullText.length) {
        setContent(fullText.slice(0, i))
      } else {
        setContent(fullText)
        setStreaming(false)
        if (timerRef.current != null) {
          window.clearInterval(timerRef.current)
          timerRef.current = null
        }
      }
    }, 80)
  }

  const stop = () => {
    if (timerRef.current != null) {
      window.clearInterval(timerRef.current)
      timerRef.current = null
    }
    setStreaming(false)
  }

  React.useEffect(() => () => stop(), [])

  return (
    <div className="flex flex-col gap-3">
      <div className="flex flex-wrap gap-2">
        <Button variant="primary" color="primary" onClick={start}>
          开始流式
        </Button>
        <Button variant="default" onClick={stop}>
          停止
        </Button>
        <Button variant="text" onClick={() => setContent("")}>
          清空
        </Button>
      </div>

      <Bubble
        avatar={<Avatar icon="mdi:robot" size="sm" />}
        header={<span>Assistant</span>}
        content={content}
        streaming={streaming}
        typing={{ effect: "typing", interval: 40, step: [1, 3], keepPrefix: true }}
        typingCursor="|"
        footer={
          <span className="text-zinc-500">
            {streaming ? "streaming..." : content ? "done" : "idle"}
          </span>
        }
      />
    </div>
  )
}

# Bubble 对话气泡

:::note
`Bubble` 支持：
- 外观：`placement`（左右）、`variant/shape`（样式与圆角）
- 结构：`avatar/header/footer/extra` 四个插槽（ReactNode 或函数）
- 渲染：`contentRender`（自定义渲染 content）
- 状态：`loading/loadingRender`
- 交互：`typing/typingCursor` + `streaming` + `onTyping/onTypingComplete`
:::

<div className="flex flex-col gap-8">
  <PlayBoard
    heading="基础气泡（slots）"
    description="支持 avatar/header/footer/extra 四个插槽。"
    code={`import { Bubble, Avatar, Button } from "haiku-ui"

export default function Demo() {
  return (
    <Bubble
      avatar={<Avatar icon="mdi:user" size="sm" />}
      header={<span>User</span>}
      content={"你好，Haiku Design!"}
      extra={<Button size="sm" variant="text">...</Button>}
      footer={<span>刚刚</span>}
    />
  )
}`}
  >
    <Bubble
      avatar={<Avatar icon="mdi:user" size="sm" />}
      header={<span>User</span>}
      content={"你好，Haiku Design!"}
      extra={<Button size="sm" variant="text">...</Button>}
      footer={<span>刚刚</span>}
    />
  </PlayBoard>

  <PlayBoard
    heading="左右对齐（placement）"
    description="placement=start/end 分别对应消息在左侧/右侧。"
    code={`<div className="flex flex-col gap-3">
  <Bubble placement="start" content="这是一条左侧消息" />
  <Bubble placement="end" content="这是一条右侧消息" />
</div>`}
  >
    <div className="flex flex-col gap-3">
      <Bubble placement="start" content="这是一条左侧消息" />
      <Bubble placement="end" content="这是一条右侧消息" />
    </div>
  </PlayBoard>

  <PlayBoard
    heading="外观（variant + shape）"
    description="variant: filled/outlined/shadow/borderless；shape: default/round/corner。"
    code={`// 见本页 VariantAndShapeDemo（省略实现代码）`}
  >
    <VariantAndShapeDemo />
  </PlayBoard>

  <PlayBoard
    heading="加载态（loading + loadingRender）"
    description="loading=true 时隐藏内容区，展示加载指示；loadingRender 可自定义。"
    code={`// 见本页 LoadingDemo（省略实现代码）`}
  >
    <LoadingDemo />
  </PlayBoard>

  <PlayBoard
    heading="插槽函数 + contentRender + info"
    description="avatar/header/footer 支持函数形态，可拿到 content 与 info；contentRender 可做自定义渲染。"
    code={`// 见本页 SlotAndContentRenderDemo（省略实现代码）`}
  >
    <SlotAndContentRenderDemo />
  </PlayBoard>

  <PlayBoard
    heading="keepPrefix 的视觉差异（A/B 切换）"
    description="先加载 A，再加载 B：keepPrefix=true 会直接保留共同前缀，false 会从头重新吐字。"
    code={`// 见本页 TypingEventsDemo（省略实现代码）`}
  >
    <TypingEventsDemo />
  </PlayBoard>

  <PlayBoard
    heading="吐字 + 流式（typing + streaming）"
    description="streaming=true 表示 content 还在追加，typing 会持续追赶；streaming=false 时触发一次 onTypingComplete。"
    code={`// 见本页 StreamTypingDemo（省略实现代码）`}
  >
    <StreamTypingDemo />
  </PlayBoard>
</div>

